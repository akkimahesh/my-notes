Understood. Below is a **clean, production-style redeployment guide from scratch** on **Amazon EC2 with Amazon Linux 2**, specifically for your stack:

* Streamlit (UI)
* FastAPI (backend)
* Nginx (reverse proxy)
* systemd (auto-start)

Follow in order â€” do not skip.

---

# ðŸš€ Phase 0 â€” Architecture (what we are building)

```
Internet
   â†“
Nginx :80
   â†“
Streamlit :8501  (UI)
   â†“
FastAPI :8000    (ML API)
```

Users will open only:

```
http://EC2-IP
```

---

# ðŸš€ Phase 1 â€” Launch & connect EC2

## Step 1.1 â€” Launch instance

Choose:

* AMI: Amazon Linux 2
* Instance: t2.micro (or higher)
* Security Group inbound:

| Port | Purpose             |
| ---- | ------------------- |
| 22   | SSH                 |
| 80   | Web                 |
| 8501 | (temporary testing) |
| 8000 | (temporary testing) |

---

## Step 1.2 â€” SSH into server

```bash
ssh -i your-key.pem ec2-user@YOUR-IP
```

---

# ðŸš€ Phase 2 â€” Prepare server

## Step 2.1 â€” Update system

```bash
sudo yum update -y
```

**Why:** installs latest security patches.

---

## Step 2.2 â€” Install required packages

```bash
sudo yum install python3 git nginx -y
```

Check:

```bash
python3 --version
nginx -v
```

---

# ðŸš€ Phase 3 â€” Deploy your project

## Step 3.1 â€” Go to working directory

```bash
cd /opt
```

**Why:** `/opt` is standard for applications.

---

## Step 3.2 â€” Clone your repo

```bash
sudo git clone https://github.com/YOUR-USERNAME/YOUR-REPO.git
```

Example for you (replace if different).

---

## Step 3.3 â€” Fix permissions

```bash
sudo chown -R ec2-user:ec2-user YOUR-REPO
cd YOUR-REPO
```

**Why:** avoid permission problems.

---

# ðŸš€ Phase 4 â€” Python environment

## Step 4.1 â€” Create virtual environment

```bash
python3 -m venv venv
source venv/bin/activate
```

**Why:** isolate dependencies.

---

## Step 4.2 â€” Upgrade pip

```bash
pip install --upgrade pip
```

---

## Step 4.3 â€” Install requirements

```bash
pip install -r requirements.txt
pip install streamlit uvicorn fastapi
```

---

# ðŸš€ Phase 5 â€” Test apps manually (IMPORTANT)

## Step 5.1 â€” Test FastAPI

Go to src:

```bash
cd src
uvicorn fast_api:app --host 0.0.0.0 --port 8000
```

Test in browser:

```
http://EC2-IP:8000/docs
```

Stop with Ctrl+C.

---

## Step 5.2 â€” Test Streamlit

```bash
streamlit run streamlit-app.py --server.port 8501 --server.address 0.0.0.0
```

Test:

```
http://EC2-IP:8501
```

Stop.

âœ… If both work â†’ proceed.

---

# ðŸš€ Phase 6 â€” Create systemd services (PRODUCTION)

This makes apps auto-start.

---

## Step 6.1 â€” Streamlit service

```bash
sudo nano /etc/systemd/system/streamlit.service
```

Paste (EDIT PATHS if needed):

```ini
[Unit]
Description=Streamlit App
After=network.target

[Service]
User=ec2-user
WorkingDirectory=/opt/YOUR-REPO/src
ExecStart=/opt/YOUR-REPO/venv/bin/streamlit run streamlit-app.py --server.port 8501 --server.address 0.0.0.0
Restart=always

[Install]
WantedBy=multi-user.target
```

Save.

---

## Step 6.2 â€” FastAPI service

```bash
sudo nano /etc/systemd/system/fastapi.service
```

Paste:

```ini
[Unit]
Description=FastAPI App
After=network.target

[Service]
User=ec2-user
WorkingDirectory=/opt/YOUR-REPO/src
ExecStart=/opt/YOUR-REPO/venv/bin/uvicorn fast_api:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

---

## Step 6.3 â€” Enable services

```bash
sudo systemctl daemon-reload
sudo systemctl enable streamlit
sudo systemctl enable fastapi
sudo systemctl start streamlit
sudo systemctl start fastapi
```

Check:

```bash
sudo systemctl status streamlit
sudo systemctl status fastapi
```

---

# ðŸš€ Phase 7 â€” Configure Nginx

## Step 7.1 â€” Edit nginx config

```bash
sudo nano /etc/nginx/nginx.conf
```

Inside the `server {}` block, use:

```nginx
location / {
    proxy_pass http://127.0.0.1:8501/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_read_timeout 86400;
}
```

---

## Step 7.2 â€” Start nginx

```bash
sudo systemctl enable nginx
sudo systemctl restart nginx
sudo nginx -t
```

---

# ðŸš€ Phase 8 â€” Final test

Open:

```
http://EC2-IP
```

âœ… Streamlit UI loads
âœ… Predictions work
âœ… No ports visible
âœ… Auto-start enabled

---

# ðŸ”¥ Phase 9 â€” Production cleanup (recommended)

After nginx works, you can **remove public access** to:

* port 8501
* port 8000

Keep only:

* 22
* 80

(in Security Group)

This improves security.

---

# ðŸŽ¯ You are now production-ready

Your deployment is now:

* persistent
* auto-restarting
* nginx fronted
* scalable ready

---

If you want next-level DevOps skills, say one:

* **"add domain + https"**
* **"dockerize this"** (very valuable for career)
* **"autoscaling architecture"**
